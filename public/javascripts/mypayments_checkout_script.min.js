LoadCheckoutPaymentContext(function (Checkout, PaymentOptions) {
  var AcmeExternalPaymentOption = PaymentOptions.ExternalPayment({
    id: "seba_mypayments_redirect",
    fields: {billing_address: true},
    onSubmit: function (callback) {
      let storeId = Checkout.getData("storeId");
      let orderId = Checkout.getData("order.cart.id");
      let currency = Checkout.getData("order.cart.currency");
      let total = Checkout.getData("order.cart.prices.total");

      Checkout
        .http
        .post(`https://localhost:9066/payment_redirect/${storeId}/${orderId}/`, {data: { currency, total }})
        .then(function (responseBody) {
          if (!responseBody.data.success) return callback({success: false, error_code: responseBody.data.error_code});
          callback({success: true, redirect: responseBody.data.redirect_url, extraAuthorize: true});
        })
        .catch(function (error) { callback({success: false, error_code: "unknown_error"}); });
    },
  });

  Checkout.addPaymentOption(AcmeExternalPaymentOption);
});
